<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Identity Starter</title>
    <script
      type="text/javascript"
      src="https://identity.netlify.com/v1/netlify-identity-widget.js"
    ></script>
    <script type="text/javascript">
      netlifyIdentity.on("login", (user) => {
        const url = new URL(document.location.href);
        // Add query param to refresh page on login for auth’d content
        if (url.searchParams.get("refresh") !== "login") {
          window.netlifyIdentity
            .refresh()
            .then((jwt) => {
              url.searchParams.set("refresh", "login");
              url.pathname =
                url.searchParams.get("return_url") || "/restricted";
              url.searchParams.delete("return_url");
              document.location.href = url.toString();
            })
            .catch((err) => {
              console.log(
                "Identity Error: Unable to get new valid token. logging out user",
                err
              );
              clearUser();
              window.netlifyIdentity.open();
            });
        }
      });
      netlifyIdentity.on("logout", () => {
        if ("URL" in window) {
          const url = new URL(document.location.href);
          // Add query param to refresh page on logout to hide auth’d content
          if (url.searchParams.get("refresh") !== "logout") {
            url.searchParams.set("refresh", "logout");
            url.searchParams.set("return_url", url.pathname);
            document.location.href = url.toString();
          }
        }
      });
    </script>
  </head>
  <body>
    <div data-netlify-identity-menu></div>
  </body>
</html>
